<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: keythereum</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">keythereum </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/ethereumjs/keythereum"></a> <a href="https://coveralls.io/github/ethereumjs/keythereum?branch=master"></a> <a href="http://badge.fury.io/js/keythereum"></a></p>
<p>Keythereum is a JavaScript tool to generate, import and export Ethereum keys. This provides a simple way to use the same account locally and in web wallets. It can be used for verifiable cold storage wallets.</p>
<p>Keythereum uses the same key derivation functions (PBKDF2-SHA256 or scrypt), symmetric ciphers (AES-128-CTR or AES-128-CBC), and message authentication codes as <a href="https://github.com/ethereum/go-ethereum">geth</a>. You can export your generated key to file, copy it to your data directory's keystore, and immediately start using it in your local Ethereum client.</p>
<h2>Installation </h2>
<pre class="fragment">$ npm install keythereum
</pre><h2>Usage </h2>
<p>To use keythereum in Node.js, just <code>require</code> it: </p><div class="fragment"><div class="line">var keythereum = require(&quot;keythereum&quot;);</div></div><!-- fragment --><p> A minified, browserified file <code>dist/keythereum.min.js</code> is included for use in the browser. Including this file simply attaches the <code>keythereum</code> object to <code>window</code>: </p><div class="fragment"><div class="line">&lt;script src=&quot;dist/keythereum.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;</div></div><!-- fragment --><h3>Key creation</h3>
<p>Generate a new random private key (256 bit), as well as the salt (256 bit) used by the key derivation function, and the initialization vector (128 bit) used to AES-128-CTR encrypt the key. <code>create</code> is asynchronous if it is passed a callback function, and synchronous otherwise. </p><div class="fragment"><div class="line">// optional private key and initialization vector sizes in bytes</div><div class="line">// (if params is not passed to create, keythereum.constants is used by default)</div><div class="line">var params = { keyBytes: 32, ivBytes: 16 };</div><div class="line"></div><div class="line">// synchronous</div><div class="line">var dk = keythereum.create(params);</div><div class="line">// dk:</div><div class="line">{</div><div class="line">    privateKey: &lt;Buffer ...&gt;,</div><div class="line">    iv: &lt;Buffer ...&gt;,</div><div class="line">    salt: &lt;Buffer ...&gt;</div><div class="line">}</div><div class="line"></div><div class="line">// asynchronous</div><div class="line">keythereum.create(params, function (dk) {</div><div class="line">    // do stuff!</div><div class="line">});</div></div><!-- fragment --><h3>Key export</h3>
<p>You will need to specify a password and (optionally) a key derivation function. If unspecified, PBKDF2-SHA256 will be used to derive the AES secret key. </p><div class="fragment"><div class="line">var password = &quot;wheethereum&quot;;</div><div class="line">var kdf = &quot;pbkdf2&quot;; // or &quot;scrypt&quot; to use the scrypt kdf</div></div><!-- fragment --><p> The <code>dump</code> function is used to export key info to keystore <a href="https://github.com/ethereum/wiki/wiki/Web3-Secret-Storage-Definition">"secret-storage" format</a>. If a callback function is supplied as the sixth parameter to <code>dump</code>, it will run asynchronously: </p><div class="fragment"><div class="line">// if options is not passed to dump, it will use the values in</div><div class="line">// keythereum.constants by default</div><div class="line">var options = {</div><div class="line">    kdf: &quot;pbkdf2&quot;,</div><div class="line">    cipher: &quot;aes-128-ctr&quot;,</div><div class="line">    kdfparams: {</div><div class="line">        c: 262144,</div><div class="line">        dklen: 32,</div><div class="line">        prf: &quot;hmac-sha256&quot;</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line">// synchronous</div><div class="line">var keyObject = keythereum.dump(password, dk.privateKey, dk.salt, dk.iv, options);</div><div class="line">// keyObject:</div><div class="line">{</div><div class="line">    address: &#39;008aeeda4d805471df9b2a5b0f38a0c3bcba786b&#39;,</div><div class="line">    Crypto: {</div><div class="line">        cipher: &#39;aes-128-ctr&#39;,</div><div class="line">        ciphertext: &#39;5318b4d5bcd28de64ee5559e671353e16f075ecae9f99c7a79a38af5f869aa46&#39;,</div><div class="line">        cipherparams: {</div><div class="line">            iv: &#39;6087dab2f9fdbbfaddc31a909735c1e6&#39;</div><div class="line">        },</div><div class="line">        mac: &#39;517ead924a9d0dc3124507e3393d175ce3ff7c1e96529c6c555ce9e51205e9b2&#39;,</div><div class="line">        kdf: &#39;pbkdf2&#39;,</div><div class="line">        kdfparams: {</div><div class="line">            c: 262144,</div><div class="line">            dklen: 32,</div><div class="line">            prf: &#39;hmac-sha256&#39;,</div><div class="line">            salt: &#39;ae3cd4e7013836a3df6bd7241b12db061dbe2c6785853cce422d148a624ce0bd&#39;</div><div class="line">        }</div><div class="line">    },</div><div class="line">    id: &#39;e13b209c-3b2f-4327-bab0-3bef2e51630d&#39;,</div><div class="line">    version: 3</div><div class="line">}</div><div class="line"></div><div class="line">// asynchronous</div><div class="line">keythereum.dump(password, dk.privateKey, dk.salt, dk.iv, options, function (keyObject) {</div><div class="line">    // do stuff!</div><div class="line">});</div></div><!-- fragment --><p> <code>dump</code> creates an object and not a JSON string. In Node, the <code>exportToFile</code> method provides an easy way to export this formatted key object to file. It creates a JSON file in the <code>keystore</code> sub-directory, and uses geth's current file-naming convention (ISO timestamp concatenated with the key's derived Ethereum address). </p><div class="fragment"><div class="line">keythereum.exportToFile(keyObject);</div></div><!-- fragment --><p> After successful key export, you will see a message like: </p><div class="fragment"><div class="line">Saved to file:</div><div class="line">keystore/UTC--2015-08-11T06:13:53.359Z--008aeeda4d805471df9b2a5b0f38a0c3bcba786b</div><div class="line"></div><div class="line">To use with geth, copy this file to your Ethereum keystore folder</div><div class="line">(usually ~/.ethereum/keystore).</div></div><!-- fragment --><h3>Key import</h3>
<p>Importing a key from geth's keystore can only be done on Node. The JSON file is parsed into an object with the same structure as <code>keyObject</code> above. </p><div class="fragment"><div class="line">// specify a data directory (optional; defaults to ~/.ethereum)</div><div class="line">var datadir = &quot;/home/jack/.ethereum-test&quot;;</div><div class="line"></div><div class="line">// synchronous</div><div class="line">var keyObject = keythereum.importFromFile(address, datadir);</div><div class="line"></div><div class="line">// asynchronous</div><div class="line">keythereum.importFromFile(address, datadir, function (keyObject) {</div><div class="line">    // do stuff</div><div class="line">});</div></div><!-- fragment --><p> This has been tested with version 3 and version 1, but not version 2, keys. (Please send me a version 2 keystore file if you have one, so I can test it!)</p>
<p>To recover the plaintext private key from the key object, use <code>keythereum.recover</code>. The private key is returned as a Buffer. </p><div class="fragment"><div class="line">// synchronous</div><div class="line">var privateKey = keythereum.recover(password, keyObject);</div><div class="line">// privateKey:</div><div class="line">&lt;Buffer ...&gt;</div><div class="line"></div><div class="line">// asynchronous</div><div class="line">keythereum.recover(password, keyObject, function (privateKey) {</div><div class="line">    // do stuff</div><div class="line">});</div></div><!-- fragment --><h3>Hashing rounds</h3>
<p>By default, keythereum uses 65536 hashing rounds in its key derivation functions, compared to the 262144 geth uses by default. (Keythereum's JSON output files are still compatible with geth, however, since they tell geth how many rounds to use.) These values are user-editable: <code>keythereum.constants.pbkdf2.c</code> is the number of rounds for PBKDF2, and <code>keythereum.constants.scrypt.n</code> is the number of rounds for scrypt.</p>
<h2>Tests </h2>
<p>Unit tests are in the <code>test</code> directory, and can be run with mocha: </p><pre class="fragment">$ npm test
</pre><p><code>test/geth.js</code> is an integration test, which is run (along with <code>test/keys.js</code>) using: </p><pre class="fragment">$ npm run geth
</pre><p><code>geth.js</code> generates 1000 random private keys, encrypts each key using a randomly-generated passphrase, dumps the encrypted key info to a JSON file, then spawns a geth instance and attempts to unlock each account using its passphrase and JSON file. The passphrases are between 1 and 100 random bytes. Each passphrase is tested in both hexadecimal and base-64 encodings, and with PBKDF2-SHA256 and scrypt key derivation functions.</p>
<p>By default, the flags passed to geth are: </p><pre class="fragment">$ geth --etherbase &lt;account&gt; --unlock &lt;account&gt; --nodiscover --networkid "10101" --port 30304 --rpcport 8547 --datadir test/fixtures --password test/fixtures/.password
</pre><p><code>test/fixtures/.password</code> is a file which contains the passphrase. The <code>.password</code> file, as well as the JSON key files generated by <code>geth.js</code>, are automatically deleted after the test.</p>
<p>(Note: <code>geth.js</code> conducts 4000 tests, each of which can take up to 5 seconds, so running this file can take up to 5.56 hours.) </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
