\href{https://travis-ci.org/websockets/ws}{\tt }

{\ttfamily ws} is a simple to use Web\+Socket implementation, up-\/to-\/date against R\+F\+C-\/6455, and \href{http://web.archive.org/web/20130314230536/http://hobbycoding.posterous.com/the-fastest-websocket-module-for-nodejs}{\tt probably the fastest Web\+Socket library for node.\+js}.

Passes the quite extensive Autobahn test suite. See \href{http://websockets.github.com/ws}{\tt http\+://websockets.\+github.\+com/ws} for the full reports.

\subsection*{Protocol support}


\begin{DoxyItemize}
\item {\bfseries Hixie draft 76} (Old and deprecated, but still in use by Safari and Opera. Added to ws version 0.\+4.\+2, but server only. Can be disabled by setting the {\ttfamily disable\+Hixie} option to true.)
\item {\bfseries Hy\+Bi drafts 07-\/12} (Use the option {\ttfamily protocol\+Version\+: 8})
\item {\bfseries Hy\+Bi drafts 13-\/17} (Current default, alternatively option {\ttfamily protocol\+Version\+: 13})
\end{DoxyItemize}

\subsubsection*{Installing}


\begin{DoxyCode}
npm install --save ws
\end{DoxyCode}


\subsubsection*{Opt-\/in for performance}

There are 2 optional modules that can be installed along side with the {\ttfamily ws} module. These modules are binary addons which improve certain operations, but as they are binary addons they require compilation which can fail if no c++ compiler is installed on the host system.


\begin{DoxyItemize}
\item {\ttfamily npm install -\/-\/save bufferutil}\+: Improves internal buffer operations which allows for faster processing of masked Web\+Socket frames and general buffer operations.
\item {\ttfamily npm install -\/-\/save utf-\/8-\/validate}\+: The specification requires validation of invalid U\+T\+F-\/8 chars, some of these validations could not be done in Java\+Script hence the need for a binary addon. In most cases you will already be validating the input that you receive for security purposes leading to double validation. But if you want to be 100\% spec-\/conforming and have fast validation of U\+T\+F-\/8 then this module is a must.
\end{DoxyItemize}

\subsubsection*{Sending and receiving text data}


\begin{DoxyCode}
var WebSocket = require('ws');
var ws = new WebSocket('ws://www.host.com/path');

ws.on('open', function open() \{
  ws.send('something');
\});

ws.on('message', function(data, flags) \{
  // flags.binary will be set if a binary data is received.
  // flags.masked will be set if the data was masked.
\});
\end{DoxyCode}


\subsubsection*{Sending binary data}


\begin{DoxyCode}
var WebSocket = require('ws');
var ws = new WebSocket('ws://www.host.com/path');

ws.on('open', function open() \{
  var array = new Float32Array(5);

  for (var i = 0; i < array.length; ++i) \{
    array[i] = i / 2;
  \}

  ws.send(array, \{ binary: true, mask: true \});
\});
\end{DoxyCode}


Setting {\ttfamily mask}, as done for the send options above, will cause the data to be masked according to the Web\+Socket protocol. The same option applies for text data.

\subsubsection*{Server example}


\begin{DoxyCode}
var WebSocketServer = require('ws').Server
  , wss = new WebSocketServer(\{ port: 8080 \});

wss.on('connection', function connection(ws) \{
  ws.on('message', function incoming(message) \{
    console.log('received: %s', message);
  \});

  ws.send('something');
\});
\end{DoxyCode}


\subsubsection*{Express\+JS example}


\begin{DoxyCode}
var server = require('http').createServer()
  , url = require('url')
  , WebSocketServer = require('ws').Server
  , wss = new WebSocketServer(\{ server: server \})
  , express = require('express')
  , app = express()
  , port = 4080;

app.use(function (req, res) \{
  res.send(\{ msg: "hello" \});
\});

wss.on('connection', function connection(ws) \{
  var location = url.parse(ws.upgradeReq.url, true);
  // you might use location.query.access\_token to authenticate or share sessions
  // or ws.upgradeReq.headers.cookie (see http://stackoverflow.com/a/16395220/151312)

  ws.on('message', function incoming(message) \{
    console.log('received: %s', message);
  \});

  ws.send('something');
\});

server.on('request', app);
server.listen(port, function () \{ console.log('Listening on ' + server.address().port) \});
\end{DoxyCode}


\subsubsection*{Server sending broadcast data}


\begin{DoxyCode}
var WebSocketServer = require('ws').Server
  , wss = new WebSocketServer(\{ port: 8080 \});

wss.broadcast = function broadcast(data) \{
  wss.clients.forEach(function each(client) \{
    client.send(data);
  \});
\};
\end{DoxyCode}


\subsubsection*{Error handling best practices}


\begin{DoxyCode}
// If the WebSocket is closed before the following send is attempted
ws.send('something');

// Errors (both immediate and async write errors) can be detected in an optional
// callback. The callback is also the only way of being notified that data has
// actually been sent.
ws.send('something', function ack(error) \{
  // if error is not defined, the send has been completed,
  // otherwise the error object will indicate what failed.
\});

// Immediate errors can also be handled with try/catch-blocks, but **note** that
// since sends are inherently asynchronous, socket write failures will *not* be
// captured when this technique is used.
try \{ ws.send('something'); \}
catch (e) \{ /* handle error */ \}
\end{DoxyCode}


\subsubsection*{echo.\+websocket.\+org demo}


\begin{DoxyCode}
var WebSocket = require('ws');
var ws = new WebSocket('ws://echo.websocket.org/', \{
  protocolVersion: 8,
  origin: 'http://websocket.org'
\});

ws.on('open', function open() \{
  console.log('connected');
  ws.send(Date.now().toString(), \{mask: true\});
\});

ws.on('close', function close() \{
  console.log('disconnected');
\});

ws.on('message', function message(data, flags) \{
  console.log('Roundtrip time: ' + (Date.now() - parseInt(data)) + 'ms', flags);

  setTimeout(function timeout() \{
    ws.send(Date.now().toString(), \{mask: true\});
  \}, 500);
\});
\end{DoxyCode}


\subsubsection*{Other examples}

For a full example with a browser client communicating with a ws server, see the examples folder.

Note that the usage together with Express 3.\+0 is quite different from Express 2.\+x. The difference is expressed in the two different serverstats-\/examples.

Otherwise, see the test cases.

\subsubsection*{Running the tests}


\begin{DoxyCode}
make test
\end{DoxyCode}


\subsection*{A\+PI Docs}

See https\+://github.com/websockets/ws/blob/master/doc/ws.\+md \char`\"{}`/doc/ws.\+md`\char`\"{} for Node.\+js-\/like docs for the ws classes.

\subsection*{Changelog}

We\textquotesingle{}re using the Git\+Hub \href{https://github.com/websockets/ws/releases}{\tt {\ttfamily releases}} for changelog entries.

\subsection*{License}

(The M\+IT License)

Copyright (c) 2011 Einar Otto Stangvik $<$\href{mailto:einaros@gmail.com}{\tt einaros@gmail.\+com}$>$

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \textquotesingle{}Software\textquotesingle{}), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions\+:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

T\+HE S\+O\+F\+T\+W\+A\+RE IS P\+R\+O\+V\+I\+D\+ED \textquotesingle{}AS IS\textquotesingle{}, W\+I\+T\+H\+O\+UT W\+A\+R\+R\+A\+N\+TY OF A\+NY K\+I\+ND, E\+X\+P\+R\+E\+SS OR I\+M\+P\+L\+I\+ED, I\+N\+C\+L\+U\+D\+I\+NG B\+UT N\+OT L\+I\+M\+I\+T\+ED TO T\+HE W\+A\+R\+R\+A\+N\+T\+I\+ES OF M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY, F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE A\+ND N\+O\+N\+I\+N\+F\+R\+I\+N\+G\+E\+M\+E\+NT. IN NO E\+V\+E\+NT S\+H\+A\+LL T\+HE A\+U\+T\+H\+O\+RS OR C\+O\+P\+Y\+R\+I\+G\+HT H\+O\+L\+D\+E\+RS BE L\+I\+A\+B\+LE F\+OR A\+NY C\+L\+A\+IM, D\+A\+M\+A\+G\+ES OR O\+T\+H\+ER L\+I\+A\+B\+I\+L\+I\+TY, W\+H\+E\+T\+H\+ER IN AN A\+C\+T\+I\+ON OF C\+O\+N\+T\+R\+A\+CT, T\+O\+RT OR O\+T\+H\+E\+R\+W\+I\+SE, A\+R\+I\+S\+I\+NG F\+R\+OM, O\+UT OF OR IN C\+O\+N\+N\+E\+C\+T\+I\+ON W\+I\+TH T\+HE S\+O\+F\+T\+W\+A\+RE OR T\+HE U\+SE OR O\+T\+H\+ER D\+E\+A\+L\+I\+N\+GS IN T\+HE S\+O\+F\+T\+W\+A\+RE. 