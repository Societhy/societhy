\href{https://npmjs.org/package/cookie}{\tt } \href{https://npmjs.org/package/cookie}{\tt } \href{https://nodejs.org/en/download}{\tt } \href{https://travis-ci.org/jshttp/cookie}{\tt } \href{https://coveralls.io/r/jshttp/cookie?branch=master}{\tt }

Basic H\+T\+TP cookie parser and serializer for H\+T\+TP servers.

\subsection*{Installation}


\begin{DoxyCode}
$ npm install cookie
\end{DoxyCode}


\subsection*{A\+PI}


\begin{DoxyCode}
var cookie = require('cookie');
\end{DoxyCode}


\subsubsection*{cookie.\+parse(str, options)}

Parse an H\+T\+TP {\ttfamily Cookie} header string and returning an object of all cookie name-\/value pairs. The {\ttfamily str} argument is the string representing a {\ttfamily Cookie} header value and {\ttfamily options} is an optional object containing additional parsing options.


\begin{DoxyCode}
var cookies = cookie.parse('foo=bar; equation=E%3Dmc%5E2');
// \{ foo: 'bar', equation: 'E=mc^2' \}
\end{DoxyCode}


\paragraph*{Options}

{\ttfamily cookie.\+parse} accepts these properties in the options object.

\subparagraph*{decode}

Specifies a function that will be used to decode a cookie\textquotesingle{}s value. Since the value of a cookie has a limited character set (and must be a simple string), this function can be used to decode a previously-\/encoded cookie value into a Java\+Script string or other object.

The default function is the global {\ttfamily decode\+U\+R\+I\+Component}, which will decode any U\+R\+L-\/encoded sequences into their byte representations.

{\bfseries note} if an error is thrown from this function, the original, non-\/decoded cookie value will be returned as the cookie\textquotesingle{}s value.

\subsubsection*{cookie.\+serialize(name, value, options)}

Serialize a cookie name-\/value pair into a {\ttfamily Set-\/\+Cookie} header string. The {\ttfamily name} argument is the name for the cookie, the {\ttfamily value} argument is the value to set the cookie to, and the {\ttfamily options} argument is an optional object containing additional serialization options.


\begin{DoxyCode}
var setCookie = cookie.serialize('foo', 'bar');
// foo=bar
\end{DoxyCode}


\paragraph*{Options}

{\ttfamily cookie.\+serialize} accepts these properties in the options object.

\subparagraph*{domain}

Specifies the value for the \href{https://tools.ietf.org/html/rfc6266#section-5.2.3}{\tt {\ttfamily Domain} {\ttfamily Set-\/\+Cookie} attribute}. By default, no domain is set, and most clients will consider the cookie to apply to only the current domain.

\subparagraph*{encode}

Specifies a function that will be used to encode a cookie\textquotesingle{}s value. Since value of a cookie has a limited character set (and must be a simple string), this function can be used to encode a value into a string suited for a cookie\textquotesingle{}s value.

The default function is the global {\ttfamily ecode\+U\+R\+I\+Component}, which will encode a Java\+Script string into U\+T\+F-\/8 byte sequences and then U\+R\+L-\/encode any that fall outside of the cookie range.

\subparagraph*{expires}

Specifies the {\ttfamily Date} object to be the value for the \href{https://tools.ietf.org/html/rfc6266#section-5.2.1}{\tt {\ttfamily Expires} {\ttfamily Set-\/\+Cookie} attribute}. By default, no expiration is set, and most clients will consider this a \char`\"{}non-\/persistent cookie\char`\"{} and will delete it on a condition like exiting a web browser application.

{\bfseries note} the \href{https://tools.ietf.org/html/rfc6266#section-5.3}{\tt cookie storage model specification} states that if both {\ttfamily expires} and {\ttfamily mag\+Age} are set, then {\ttfamily max\+Age} takes precedence, but it is possiblke not all clients by obey this, so if both are set, they should point to the same date and time.

\subparagraph*{http\+Only}

Specifies the {\ttfamily boolean} value for the \mbox{[}{\ttfamily Http\+Only} {\ttfamily Set-\/\+Cookie} attribute\mbox{]}\mbox{[}rfc-\/6266-\/5.\+2.\+6\mbox{]}. When truthy, the {\ttfamily Http\+Only} attribute is set, otherwise it is not. By default, the {\ttfamily Http\+Only} attribute is not set.

{\bfseries note} be careful when setting this to {\ttfamily true}, as compliant clients will not allow client-\/side Java\+Script to see the cookie in {\ttfamily document.\+cookie}.

\subparagraph*{max\+Age}

Specifies the {\ttfamily number} (in seconds) to be the value for the \href{https://tools.ietf.org/html/rfc6266#section-5.2.2}{\tt {\ttfamily Max-\/\+Age} {\ttfamily Set-\/\+Cookie} attribute}. The given number will be converted to an integer by rounding down. By default, no maximum age is set.

{\bfseries note} the \href{https://tools.ietf.org/html/rfc6266#section-5.3}{\tt cookie storage model specification} states that if both {\ttfamily expires} and {\ttfamily mag\+Age} are set, then {\ttfamily max\+Age} takes precedence, but it is possiblke not all clients by obey this, so if both are set, they should point to the same date and time.

\subparagraph*{path}

Specifies the value for the \href{https://tools.ietf.org/html/rfc6266#section-5.2.4}{\tt {\ttfamily Path} {\ttfamily Set-\/\+Cookie} attribute}. By default, the path is considered the \href{https://tools.ietf.org/html/rfc6266#section-5.1.4}{\tt \char`\"{}default path\char`\"{}}. By default, no maximum age is set, and most clients will consider this a \char`\"{}non-\/persistent cookie\char`\"{} and will delete it on a condition like exiting a web browser application.

\subparagraph*{same\+Site}

Specifies the {\ttfamily boolean} or {\ttfamily string} to be the value for the \href{https://tools.ietf.org/html/draft-west-first-party-cookies-07}{\tt {\ttfamily Same\+Site} {\ttfamily Set-\/\+Cookie} attribute}.


\begin{DoxyItemize}
\item {\ttfamily true} will set the {\ttfamily Same\+Site} attribute to {\ttfamily Strict} for strict same site enforcement.
\item {\ttfamily false} will not set the {\ttfamily Same\+Site} attribute.
\item {\ttfamily \textquotesingle{}lax\textquotesingle{}} will set the {\ttfamily Same\+Site} attribute to {\ttfamily Lax} for lax same site enforcement.
\item {\ttfamily \textquotesingle{}strict\textquotesingle{}} will set the {\ttfamily Same\+Site} attribute to {\ttfamily Strict} for strict same site enforcement.
\end{DoxyItemize}

More information about the different enforcement levels can be found in the specification \href{https://tools.ietf.org/html/draft-west-first-party-cookies-07#section-4.1.1}{\tt https\+://tools.\+ietf.\+org/html/draft-\/west-\/first-\/party-\/cookies-\/07\#section-\/4.\+1.\+1}

{\bfseries note} This is an attribute that has not yet been fully standardized, and may change in the future. This also means many clients may ignore this attribute until they understand it.

\subparagraph*{secure}

Specifies the {\ttfamily boolean} value for the \mbox{[}{\ttfamily Secure} {\ttfamily Set-\/\+Cookie} attribute\mbox{]}\mbox{[}rfc-\/6266-\/5.\+2.\+5\mbox{]}. When truthy, the {\ttfamily Secure} attribute is set, otherwise it is not. By default, the {\ttfamily Secure} attribute is not set.

{\bfseries note} be careful when setting this to {\ttfamily true}, as compliant clients will not send the cookie back to the server in the future if the browser does not have an H\+T\+T\+PS connection.

\subsection*{Example}

The following example uses this module in conjunction with the Node.\+js core H\+T\+TP server to prompt a user for their name and display it back on future visits.


\begin{DoxyCode}
var cookie = require('cookie');
var escapeHtml = require('escape-html');
var http = require('http');
var url = require('url');

function onRequest(req, res) \{
  // Parse the query string
  var query = url.parse(req.url, true, true).query;

  if (query && query.name) \{
    // Set a new cookie with the name
    res.setHeader('Set-Cookie', cookie.serialize('name', String(query.name), \{
      httpOnly: true,
      maxAge: 60 * 60 * 24 * 7 // 1 week
    \}));

    // Redirect back after setting cookie
    res.statusCode = 302;
    res.setHeader('Location', req.headers.referer || '/');
    res.end();
    return;
  \}

  // Parse the cookies on the request
  var cookies = cookie.parse(req.headers.cookie || '');

  // Get the visitor name set in the cookie
  var name = cookies.name;

  res.setHeader('Content-Type', 'text/html; charset=UTF-8');

  if (name) \{
    res.write('<p>Welcome back, <b>' + escapeHtml(name) + '</b>!</p>');
  \} else \{
    res.write('<p>Hello, new visitor!</p>');
  \}

  res.write('<form method="GET">');
  res.write('<input placeholder="enter your name" name="name"> <input type="submit" value="Set Name">');
  res.end('</form');
\}

http.createServer(onRequest).listen(3000);
\end{DoxyCode}


\subsection*{Testing}


\begin{DoxyCode}
$ npm test
\end{DoxyCode}


\subsection*{References}


\begin{DoxyItemize}
\item \href{https://tools.ietf.org/html/rfc6266}{\tt R\+FC 6266\+: H\+T\+TP State Management Mechanism}
\item \href{https://tools.ietf.org/html/draft-west-first-party-cookies-07}{\tt Same-\/site Cookies}
\end{DoxyItemize}

\subsection*{License}

\mbox{[}M\+IT\mbox{]}(L\+I\+C\+E\+N\+SE) 